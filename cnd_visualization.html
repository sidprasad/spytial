<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CnD Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        #graph-container {
            width: 800px;
            height: 600px;
            border: 2px solid #007acc;
            border-radius: 8px;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <!-- WebCola CND Graph Element -->
    <webcola-cnd-graph 
        id="graph-container"
        width="800" 
        height="600"
        layoutFormat="default"
        aria-label="Interactive graph visualization">
    </webcola-cnd-graph>

    <script src="https://cdn.jsdelivr.net/npm/cnd-core/dist/browser/cnd-core-complete.global.js"></script>
    <script>
        // Embedded data passed from the server
        const cndSpec = `constraints: []
directives: []
`;
        const jsonData = `{'atoms': [{'id': 'n1', 'type': 'str', 'label': 'Alice'}, {'id': 'n2', 'type': 'int', 'label': '30'}, {'id': 'n4', 'type': 'str', 'label': 'reading'}, {'id': 'n5', 'type': 'str', 'label': 'cycling'}, {'id': 'n3', 'type': 'list', 'label': 'list[2]'}, {'id': 'n7', 'type': 'str', 'label': '123 Main St'}, {'id': 'n8', 'type': 'str', 'label': 'Anytown'}, {'id': 'n6', 'type': 'dict', 'label': 'dict{2}'}, {'id': 'n0', 'type': 'dict', 'label': 'dict{4}'}], 'relations': [{'id': '0', 'name': '0', 'types': ['object', 'object'], 'tuples': [{'atoms': ['n3', 'n4'], 'types': ['list', 'str']}]}, {'id': '1', 'name': '1', 'types': ['object', 'object'], 'tuples': [{'atoms': ['n3', 'n5'], 'types': ['list', 'str']}]}, {'id': 'street', 'name': 'street', 'types': ['object', 'object'], 'tuples': [{'atoms': ['n6', 'n7'], 'types': ['dict', 'str']}]}, {'id': 'city', 'name': 'city', 'types': ['object', 'object'], 'tuples': [{'atoms': ['n6', 'n8'], 'types': ['dict', 'str']}]}, {'id': 'name', 'name': 'name', 'types': ['object', 'object'], 'tuples': [{'atoms': ['n0', 'n1'], 'types': ['dict', 'str']}]}, {'id': 'age', 'name': 'age', 'types': ['object', 'object'], 'tuples': [{'atoms': ['n0', 'n2'], 'types': ['dict', 'int']}]}, {'id': 'hobbies', 'name': 'hobbies', 'types': ['object', 'object'], 'tuples': [{'atoms': ['n0', 'n3'], 'types': ['dict', 'list']}]}, {'id': 'address', 'name': 'address', 'types': ['object', 'object'], 'tuples': [{'atoms': ['n0', 'n6'], 'types': ['dict', 'dict']}]}]}`;

        /**
         * Load and render the graph using the webcola-cnd-graph custom element
         */
        async function loadGraph() {
            const graphElement = document.getElementById('graph-container');
            try {
                // Create a data instance from the JSON data
                const dataInstance = new CndCore.JSONDataInstance(jsonData);

                // Initialize the evaluation context
                const evaluationContext = { sourceData: dataInstance };
                const sgqEvaluator = new CndCore.SGraphQueryEvaluator();
                sgqEvaluator.initialize(evaluationContext);

                // Parse the CND specification
                const layoutSpec = CndCore.parseLayoutSpec(cndSpec);

                // Generate the layout
                const layoutInstance = new CndCore.LayoutInstance(layoutSpec, sgqEvaluator, 0, true);
                const layoutResult = layoutInstance.generateLayout(dataInstance, {});
                const instanceLayout = layoutResult.layout;

                // Render the graph
                await graphElement.renderLayout(instanceLayout);
                console.log('Graph rendered successfully!');
            } catch (error) {
                console.error('Error rendering graph:', error);
            }
        }

        // Auto-load the graph on page load
        window.addEventListener('load', loadGraph);
    </script>
</body>
</html>